dimg: 'php'
from: 'php:7.2-fpm-alpine'
docker:
  WORKDIR: /app
  USER: app
  EXPOSE: "9000"
  ENV:
    COMPOSER_ALLOW_SUPERUSER: '1'
git:
- add: /
  to: /app
#  owner: app
shell:
  beforeInstall:
#  - apt-get update
#  - apt-get install -y locales ca-certificates curl software-properties-common
#  - locale-gen en_US.UTF-8
#  - groupadd -g 242 app
#  - useradd -m -d /app -g 242 -u 242 -s /bin/bash app
#  # https://askubuntu.com/posts/490910/revisions
#  - LC_ALL=C.UTF-8 add-apt-repository -y ppa:ondrej/php
#  - apt-get update
#  - apt-get install -y php7.2 php-sqlite3 php-xml php-zip php-mbstring php-intl
  - curl -LsS https://getcomposer.org/download/1.4.1/composer.phar -o /usr/local/bin/composer
  - chmod a+x /usr/local/bin/composer
  install:
  - cd /app && composer install
  setup:
#  - "echo '#!/bin/bash' >> /app/start.sh"
#  - echo 'php bin/console server:run 0.0.0.0:8000' >> /app/start.sh
#  - echo `date` > /app/version.txt
#  - chown app:app /app/start.sh /app/version.txt
#  - chmod +x /app/start.sh
---
dimg: "nginx"
from: 'nginx:1.12-alpine'
git:
  - add: /.dapp/nginx/conf/vhost/default.conf
    to: /etc/nginx/conf.d/default.conf
#    stageDependencies:
#      install: .dapp/nginx/*
  - add: /
    to: /app
    owner: nginx
    group: nginx